
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ethereum Block and USDT Transfer Monitor</title>
</head>
<body>
  <h1>以太坊监视器</h1>
  <div>
    <h2>监听最新区块：</h2>
    <p><strong>Block Height:</strong> <span id="blockHeight">Loading...</span></p>
    <p><strong>Block Hash:</strong> <span id="blockHash">Loading...</span></p>
  </div>
  
  <div>
    <h2>USDT 流水日志： </h2>
    <div id="transferLogs">Listening for USDT transfers...</div>
  </div>

  <script type="module">
    import { ethers } from 'https://cdn.jsdelivr.net/npm/ethers@5.7.1/dist/ethers.esm.min.js';
    import { createPublicClient, http } from 'https://cdn.jsdelivr.net/npm/viem@0.5.7/dist/index.module.js';
    import { mainnet } from 'https://cdn.jsdelivr.net/npm/viem@0.5.7/dist/chains/mainnet.module.js';

    const provider = new ethers.providers.JsonRpcProvider('https://mainnet.infura.io/v3/59d76783bf2a4c9e9e202e59876c075f');

    // Viem client setup
    const client = createPublicClient({
      chain: mainnet,
      transport: http('https://mainnet.infura.io/v3/59d76783bf2a4c9e9e202e59876c075f')
    });

    const USDT_ADDRESS = '0xdAC17F958D2ee523a2206206994597C13D831ec7';
    const TRANSFER_TOPIC = ethers.utils.id('Transfer(address,address,uint256)');

    // Elements to display block and transfer info
    const blockHeightEl = document.getElementById('blockHeight');
    const blockHashEl = document.getElementById('blockHash');
    const transferLogsEl = document.getElementById('transferLogs');

    // Monitor latest blocks
    async function monitorBlocks() {
      client.watchBlocks({
        onBlock: (block) => {
          blockHeightEl.textContent = block.number;
          blockHashEl.textContent = block.hash;
          console.log(`New Block - Height: ${block.number}, Hash: ${block.hash}`);
        }
      });
    }

    // Monitor USDT transfer events
    async function monitorUSDTTransfers() {
      provider.on({
        address: USDT_ADDRESS,
        topics: [TRANSFER_TOPIC]
      }, (log) => {
        const decodedLog = ethers.utils.defaultAbiCoder.decode(
          ['address', 'address', 'uint256'],
          log.data
        );
        const from = decodedLog[0];
        const to = decodedLog[1];
        const amount = ethers.utils.formatUnits(decodedLog[2], 6);

        const logMessage = `From: ${from} -> To: ${to} | Amount: ${amount} USDT | Block: ${log.blockNumber} | Tx: ${log.transactionHash}`;
        const logElement = document.createElement('p');
        logElement.textContent = logMessage;
        transferLogsEl.prepend(logElement);
      });
    }

    // Start monitoring
    monitorBlocks();
    monitorUSDTTransfers();
  </script>
</body>
</html>
